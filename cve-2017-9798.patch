From 0a5e1edc103f73032711fb78eee4a66baa6a2c4f Mon Sep 17 00:00:00 2001
From: Victor Rodriguez <victor.rodriguez.bahena@intel.com>
Date: Sat, 30 Sep 2017 16:12:55 +0000
Subject: [PATCH] CVE-2017-9798

Backport from https://svn.apache.org/viewvc?view=revision&revision=1807655
---
 server/core.c | 6 ++++++
 1 file changed, 6 insertions(+)

diff --git a/server/core.c b/server/core.c
index 20fa583..fbfaa86 100644
--- a/server/core.c
+++ b/server/core.c
@@ -2262,6 +2262,12 @@ AP_CORE_DECLARE_NONSTD(const char *) ap_limit_section(cmd_parms *cmd,
             /* method has not been registered yet, but resource restriction
              * is always checked before method handling, so register it.
              */
+            if (cmd->pool == cmd->temp_pool) {
+                /* In .htaccess, we can't globally register new methods. */
+                return apr_psprintf(cmd->pool, "Could not register method '%s' "
+                        "for %s from .htaccess configuration",
+                        method, cmd->cmd->name);
+            }
             methnum = ap_method_register(cmd->pool,
                                          apr_pstrdup(cmd->pool, method));
         }
-- 
2.14.2

